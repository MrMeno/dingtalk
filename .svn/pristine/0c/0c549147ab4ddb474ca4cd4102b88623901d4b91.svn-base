<template>
	<div class='container-fluid' style='padding:10px'>
		<div class="row" style='padding:0px'>
			<div class="col col-md-12 col-sm-12 text-left" style='padding:0px'>
				票据
			</div>
		</div>
		
		<div class="row" style='background-color:white'>
			<div class="col col-md-12 col-sm-12">
				<div class="row" style='line-height:30px;padding:10px'>
					<div class="col col-md-2 col-sm-2 text-right">
						票号：
					</div>
					<div class="col col-md-3 col-sm-3 text-left">
						<el-input type='text' v-model='tickNum' placeholder='请输入票号'></el-input>
					</div>

					<div class="col col-md-3 col-sm-3">
						<div class="row">
							<div class="col-md-6 col-sm-6 text-right">
								<el-button type="primary" @click='search'>查询</el-button>
							</div>
							<div class="col-md-6 col-sm-6 text-left">
								<el-button type="danger" @click="cleans">清空</el-button>
							</div>
						</div>

					</div>
					<div class="col col-md-4 col-sm-4 text-right">
						<div class="row">
							<div class="col col-md-12 col-sm-12 text-right">
					           <el-button type='text' @click='isShow=!isShow'>
					           {{isShow?'收起':'展开'}}
					           <i class="el-icon-caret-bottom el-icon--right" v-if='!isShow'></i>
					           <i class="el-icon-caret-top el-icon--right" v-if='isShow'></i>
					       </el-button>
							</div>
						</div>
					</div>
				</div>

					<div class="row" style='line-height:30px;padding:10px' v-if='isShow'>
					<div class="col col-md-2 col-sm-2 text-right">
						票据类型：
					</div>
					<div class="col col-md-5 col-sm-5 text-left">
						 <el-checkbox-group v-model="billClassify" @change="search">
                         <el-checkbox v-for='item in billClassifyList' :label='item.dictKey'
                         :key='item.dictKey'>{{item.dictValue}}</el-checkbox>
                      </el-checkbox-group>
					</div>

					<div class="col col-md-2 col-sm-2 text-right">
                         来源：
					</div>

					<div class="col col-md-3 col-sm-3">
                          <el-checkbox-group v-model="billSource">
                         <el-checkbox v-for='items in billSourceList' :key='items.dictKey' :label='items.dictKey'>{{items.dictValue}}</el-checkbox>
                      </el-checkbox-group>
					</div>
				</div>

					<div class="row" style='line-height:30px;padding:10px' v-if='isShow'>
					<div class="col col-md-2 col-sm-2 text-right">
						承兑人名称：
					</div>
					<div class="col col-md-3 col-sm-3 text-left">
							<el-input type='text' placeholder='请输入承兑人名称' v-model='acceptorName'></el-input>
					</div>

					<div class="col col-md-4 col-sm-4 text-right">
                         是否到期：
					</div>

					<div class="col col-md-3 col-sm-3">
                          <el-checkbox-group v-model="due">
                         <el-checkbox v-for='item in dueList' :label='item.key' :key='item.key'>{{item.value}}</el-checkbox>
               
                      </el-checkbox-group>
					</div>
				</div>

					<div class="row" style='line-height:30px;padding:10px' v-if='isShow'>
					<div class="col col-md-2 col-sm-2 text-right">
						金额：
					</div>
					<div class="col col-md-3 col-sm-3 text-left">
							<div class="row">
								<div class="col col-md-6 col-sm-6">
								<el-input type='text' placeholder='请输入金额' v-model='startBillAmount'></el-input>
							</div>
							<div class="col col-md-6 col-sm-6">
								<el-input type='text' placeholder='请输入金额' v-model='endBillAmount'></el-input>
							</div>
							</div>
					</div>

					<div class="col col-md-2 col-sm-2 text-right">
                         到期日：
					</div>

			      <div class="col col-md-5 col-sm-5">
                     <div class="row">
				      <div class="col col-md-6 col-sm-6">
				        <el-date-picker type="date" size="small" v-model='startDueDate' format='yyyy-MM-dd' placeholder="选择日期">  </el-date-picker></div>
				       <div class="col col-md-6 col-sm-6">
				        <el-date-picker type="date" size="small" v-model='endDueDate' format='yyyy-MM-dd' placeholder="选择日期" > </el-date-picker></div>
			         </div>
			    </div>
			  </div>

			  <div class="row" style='line-height:30px;padding:10px' v-if='isShow'>
					<div class="col col-md-2 col-sm-2 text-right">
						承兑人类别：
					</div>
					<div class="col col-md-10 col-sm-10 text-left">
						 <el-checkbox-group v-model="acceptorType">
                         <el-checkbox v-for='items in acceptorTypeList' :label='items.dictKey' :key='items.dictKey'>{{items.dictValue}}</el-checkbox>
                      </el-checkbox-group>
					</div>
				</div>


			</div>
		</div>
		<div class="row" style='background-color:white;margin-top:20px'>
			<div class="col col-md-12 col-sm-12">
				<div class="row">
					<div class="col col-md-12 col-sm-12">
						 <el-tabs v-model="billStatus" @tab-click="tabSwitch">
						  <el-tab-pane name='all' label='全部'></el-tab-pane>
                          <el-tab-pane v-for='item in billStatusList'  :label='item.dictValue' :name='item.dictKey' ></el-tab-pane>
                       </el-tabs>
					</div>
				</div>

				<div class="row" style='margin-top:15px'>
				  <div class="col col-md-9 col-sm-9">
				  	<div class="row">
				  			<div class="col col-md-2 col-sm-2 text-center">
						<el-button type="primary" @click='all' v-bind:style="{backgroundColor:btnStyle,borderColor:btnStyle}">{{isTotal?'取消批量操作':'批量操作'}}</el-button>
					</div>
					<div class="col col-md-2 col-sm-2 text-center"  v-if='isTotal'>
						<el-button type="primary" @click='dialogVisible=true'>批量更新状态</el-button>
					</div>
					<div class="col col-md-2 col-sm-2 text-center"  v-if='isTotal'>
						<el-button type="danger" @click='dialogVisible_d=true'>批量删除</el-button>
					</div>
					<div class="col col-md-2 col-sm-2 text-left">
						<a :href='loadUrl' ref='loadClick'><el-button @click='exportTick'>导出</el-button></a>
            
					</div>
				  	</div>
				  </div>
				</div>

			<div class="row" style='padding:20px'>
				<div class="col col-md-12 col-sm-12">
				  <el-table ref="multipleTable" height='400' @selection-change="handleSelectionChange" :data="tableData" style="width: 100%;" v-loading="loading">
                   <el-table-column
                     type="selection" v-if='isTotal'>
                         </el-table-column>
                    <el-table-column  label="操作">
                         <template scope="scope">
                         	  <el-popover placement="top"  trigger="click" :visible-arrow="true">
                         	     <div class="row" style='background-color:white;padding:0px 10px;margin:0px'>
                         	     	<div class="col col-md-3 col-sm-3" v-if="scope.row.ocrStatus!='识别失败'">
                         	     		 <el-button type='text' @click='detail(scope.row.id,scope.row.version,scope.row.billMedium)'>查看</el-button>
                         	     	</div>
                         	     	<div class="col col-md-3 col-sm-3" v-if="scope.row.ocrStatus!='识别失败'">
                         	     		<el-button type='text' @click='edit(scope.row.id,scope.row.version,scope.row.billNo,scope.row.billMedium)'>编辑</el-button>
                         	     	</div>
                         	     	<div class="col col-md-3 col-sm-3 text-center" >
                         	     		<el-button type='text' @click='singleDel(scope.row.id,scope.row.version)'>删除 </el-button>
                         	     	</div>
                         	     	<div class="col col-md-3 col-sm-3" v-if="scope.row.ocrStatus!='识别失败'">
                         	     		<el-button type='text' @click='telPrice(scope.row)'>询价</el-button>
                         	     	</div>
                         	     </div>
                         	   <img src="../../assets/action.png" slot='reference' style='cursor:pointer'>
                             </el-popover>
                         </template>
                   </el-table-column>

                    <el-table-column label="票号">
                      <template scope="scope">
                      	  {{scope.row.billNo}} 
                        <el-popover placement="right" v-if='scope.row.notice'  width="400"  trigger="hover" :visible-arrow="false">
                           <div class='row' style='padding:20px 0px;background-color:#fffada'>
                           	  <div class="col col-md-12 text-center">
                           	       <div class="row">
                           	       	<div class="col col-md-12 col-sm-12" style='color:red'>
                           	       		风险票
                           	       	</div>
                           	       </div>
                           	        <div class="row" style='padding-top:10px'>
                           	       	<div class="col col-md-4 col-sm-4">
                           	       		申请人
                           	       	</div>
                           	       	 	<div class="col col-md-8 col-sm-8">
                           	       		{{scope.row.notice.applyName||''}}
                           	       	</div>
                           	       </div>

                           	        <div class="row" style='padding-top:5px'>
                           	       	<div class="col col-md-4 col-sm-4">
                           	       		票号
                           	       	</div>
                           	       	 	<div class="col col-md-8 col-sm-8" style='word-wrap:break-word;'>
                           	       		{{scope.row.notice.billNo}}
                           	       	</div>
                           	       </div>

                           	        <div class="row" style='padding-top:5px'>
                           	       	<div class="col col-md-4 col-sm-4">
                           	       		金额
                           	       	</div>
                           	       	 	<div class="col col-md-8 col-sm-8">
                           	       		{{scope.row.notice.billAmount}}
                           	       	</div>
                           	       </div>

                           	       <div class="row" style='padding-top:5px'>
                           	       	<div class="col col-md-4 col-sm-4">
                           	       		公示时间
                           	       	</div>
                           	       	 	<div class="col col-md-8 col-sm-8">
                           	       		{{scope.row.notice.noticeDate}}
                           	       	</div>
                           	       </div>
                           	       <div class="row" style='padding-top:5px'>
                           	       	<div class="col col-md-4 col-sm-4">
                           	       		截止时间
                           	       	</div>
                           	       	 	<div class="col col-md-8 col-sm-8">
                           	       		{{scope.row.notice.deadline}}
                           	       	</div>
                           	       </div>
                           	  </div>
                           </div>
                           <el-button type='text' slot='reference' v-if='scope.row.isPublic==1'>
                        	<img src="../../assets/danger.png"  >
                          </el-button> 
                        </el-popover>
                      </template>
                    </el-table-column>


                    <el-table-column prop="billClassify" label="类型">
                    </el-table-column>
                     <el-table-column prop="billAmount" label="金额">
                    </el-table-column>
                     <el-table-column prop="dueDate" label="到期日">
                    </el-table-column>
                     <el-table-column prop="acceptorName" label="承兑人">
                    </el-table-column>
                     <el-table-column prop="acceptorTypeName" label="承兑人类别">
                    </el-table-column>
                     <el-table-column prop="billStatus" label="状态">
                                
                    </el-table-column>

                     <el-table-column prop="ocrStatus" label="识别状态">
                                
                    </el-table-column>
                    </el-table>
              
				 </div>
			  </div>

			  <div class="row" style='padding-top:20px'>
			  	<div class="col col-md-12 col-sm-12 text-center">
          <el-pagination  @size-change="handleSizeChange"   @current-change="handleCurrentChange" :current-page="pageNo"  :page-sizes="[5,10,15,20]" :page-size="pageSize" layout="total, sizes, prev, pager, next, jumper" :total="totalItem"> </el-pagination>
			  	</div>
			  </div>

			  <div class="row">
			  	<div class="col col-md-12 col-sm-12">
                   <el-dialog title="批量更新状态" size='small' :visible.sync="dialogVisible">
                       <div class="row">
                       	<div class="col col-md-8 col-sm-8 col-md-offset-2 col-sm-offset-2">
                       		<div class="row">
                       			<div class="col col-md-6 col-sm-6">
                       				票面总额：
                       			</div>
                       			<div class="col col-md-6 col-sm-6 text-left">
                       			  {{tickAmount}}元
                       			</div>
                       		</div>
                       		<div class="row" style='padding-top:30px'>
                       			<div class="col col-md-6 col-sm-6">
                       				累计张数：
                       			</div>
                       			<div class="col col-md-6 col-sm-6 text-left">
                       			  {{pieces}}张
                       			</div>
                       		</div>

                       		<div class="row" style='padding-top:30px'>
                       			<div class="col col-md-6 col-sm-6">
                       				状态设置：
                       			</div>
                       			<div class="col col-md-6 col-sm-6 text-left">
                       			 <el-select v-model="billStatus_p" placeholder="请选择状态"style='width:65%'>
                                    <el-option   v-for="item in billStatusList"  :key="item.dictKey"  :label="item.dictValue"  :value="item.dictKey"></el-option> 
                                 </el-select>
                       			</div>
                       		</div>

                       		<div class="row" style='padding-top:30px'>
                       			<div class="col col-md-6 col-sm-6 text-right">
                       				<el-button :plain='true' @click='dialogVisible=false'>取消</el-button>
                       			</div>
                       			<div class="col col-md-6 col-sm-6 text-left">
                       				<el-button type='primary' @click='p_update'>确定</el-button>
                       			</div>
                       		</div>
                       	</div>
                       </div>
                      
                  </el-dialog>
			  	</div>
			  </div>


			  <div class="row">
			  	<div class="col col-md-12 col-sm-12">
                   <el-dialog title="批量删除" size='small' :visible.sync="dialogVisible_d">
                       <div class="row">
                       	<div class="col col-md-8 col-sm-8 col-md-offset-2 col-sm-offset-2">

                       			<div class="row" >
                       			<div class="col col-md-12 col-sm-12 text-center">
                       				<strong>确认要删除以下票据？</strong>
                       			</div>
                       		</div>
                       		<div class="row" style='padding-top:30px'>
                       			<div class="col col-md-6 col-sm-6">
                       				票面总额：
                       			</div>
                       			<div class="col col-md-6 col-sm-6 text-left">
                       			  {{tickAmount||'0'}}元
                       			</div>
                       		</div>
                       		<div class="row" style='padding-top:30px'>
                       			<div class="col col-md-6 col-sm-6">
                       				累计张数：
                       			</div>
                       			<div class="col col-md-6 col-sm-6 text-left">
                       			  {{pieces}}张
                       			</div>
                       		</div>
                       		<div class="row" style='padding-top:30px'>
                       			<div class="col col-md-6 col-sm-6 text-right">
                       				<el-button :plain='true' @click='dialogVisible_d=false'>取消</el-button>
                       			</div>
                       			<div class="col col-md-6 col-sm-6 text-left">
                       				<el-button type='primary' @click='p_del'>确定</el-button>
                       			</div>
                       		</div>
                       	</div>
                       </div>                   
                </el-dialog>
			  	</div>
			  </div>

            <div class="row">
          <div class="col col-md-12 col-sm-12" style='line-height:30px'>
                  <el-dialog title="询价" size='large' :visible.sync="dialogVisible_x" style='max-height:1000px'>
                   <el-row :gutter='10'>
                       <el-col :span='2' style='text-align:left'>
                         票号：
                       </el-col>
                       <el-col :span='4' style='text-align:left'>
                         {{selectRow.billNo}}
                       </el-col>
                       <el-col :span='2' style='text-align:right'>
                         介质:
                       </el-col>
                       <el-col :span='1' style='text-align:left'>
                         {{selectRow.billMediumName}}
                       </el-col>
                       <el-col :span='2' style='text-align:right'>
                         承兑人类别:
                       </el-col>
                       <el-col :span='1' style='text-align:left'>
                         {{selectRow.acceptorTypeName}}
                       </el-col>
                       <el-col :span='2' style='text-align:right'>
                         金额:
                       </el-col>
                       <el-col :span='2' style='text-align:left'>
                         {{selectRow.billAmount}}元
                       </el-col>
                        <el-col :span='2' style='text-align:right'>
                         到期日:
                       </el-col>
                       <el-col :span='2' style='text-align:left'>
                         {{selectRow.dueDate}}
                       </el-col>
                        <el-col :span='2' style='text-align:right'>
                         天数:
                       </el-col>
                       <el-col :span='2' style='text-align:left'>
                         {{selectRow.limitDays}}天
                       </el-col>
                   </el-row> 
                    <el-row :gutter='10' style='padding:20px 0px;border-bottom:solid 1px #ddd'>
                       <el-col :span='2' style='text-align:left'>
                         贴现地：
                       </el-col>
                       <el-col :span='4' style='text-align:left'>
                         <el-select v-model="province" filterable clearable  placeholder="请选择" @change='getCity'>
                           <el-option v-for='items in provinceList' :label='items.areaName' :key='items.areaNo' :value='items.areaNo' ></el-option>
                         </el-select>       
                       </el-col>

                       <el-col :span='4' style='text-align:left'>
                         <el-select v-model="city" filterable clearable  placeholder="请选择">
                           <el-option v-for='items in cityList' :label='items.areaName' :key='items.areaNo' :value='items.areaNo'></el-option>
                         </el-select>
                       </el-col>
                       <el-col :span='4' style='text-align:right'>
                         合计扣款（万元）:
                       </el-col>
                       <el-col :span='3' style='text-align:left'>
                        <el-input type='text' placeholder='请输入扣款下限' v-model='priceParams.totalDeductLower'></el-input>
                       </el-col>
                       <el-col :span='3' style='text-align:right'>
                        <el-input type='text' placeholder='请输入扣款上限' v-model='priceParams.totalDeductUp'></el-input>
                       </el-col>
                       <el-col :span='2' style='text-align:right'>
                         <el-button type='primary' @click='getPriceList'>查询</el-button>
                       </el-col>

                   </el-row> 
                   <el-row style='padding-top:30px' v-if='priceData!=null'>
                      <el-col>
                          <el-table  :data="priceData" height='300'>        
                             <el-table-column
                           prop="orgName"
                          label="名称">
                          </el-table-column>
                           <el-table-column
                           prop="distance"
                          label="距离/km">
                          </el-table-column>
                           <el-table-column
                           prop="tradeModel"
                          label="模式">
                          </el-table-column>
                           <el-table-column
                           prop="totalDeduct"
                          label="合计扣款（万元）">
                          </el-table-column>
                           <el-table-column
                           prop="price"
                          label="价格">
                          </el-table-column>
                           <el-table-column
                           prop="addDays"
                          label="加天">
                          </el-table-column>

                           <el-table-column
                           prop="area"
                          label="所属区域">
                          </el-table-column>

                       <el-table-column type="expand">
                          <template scope="props">
                             <div class="row">
                               <div class="col col-md-12 col-sm-12 text-left">
                                 联系方式：{{props.row.contactWay}}
                               </div>
                             </div>
                             <div class="row" style='padding-top:10px'>
                               <div class="col col-md-12 col-sm-12 text-left">
                                 经营地址：{{props.row.orgAddr}}
                               </div>
                             </div>
                              <div class="row" style='padding-top:10px'>
                               <div class="col col-md-12 col-sm-12 text-left">
                                 计息天数：{{props.row.limitDays}}
                               </div>
                             </div>
                              <div class="row" style='padding-top:10px'>
                               <div class="col col-md-12 col-sm-12 text-left">
                                 贴现利息：{{props.row.interest}}
                               </div>
                             </div>
                              <div class="row" style='padding-top:10px'>
                               <div class="col col-md-12 col-sm-12 text-left">
                                 费用合计：{{props.row.totalDeduct}}
                               </div>
                             </div>
                              <div class="row" style='padding-top:10px'>
                               <div class="col col-md-12 col-sm-12 text-left">
                                 交易备注：{{props.row.remark}}
                               </div>
                             </div>
                              <div class="row" style='padding-top:10px'>
                               <div class="col col-md-12 col-sm-12 text-left">
                                 公司介绍：{{props.row.orgIntro}}
                               </div>
                             </div>
                              <div class="row" style='padding-top:10px'>
                               <div class="col col-md-12 col-sm-12 text-left">
                                 主营业务：{{props.row.orgBus}}
                               </div>
                             </div>

                         </template>
                          </el-table-column>
                          </el-table>
                         
                      </el-col>
                   </el-row>             
                </el-dialog>
               </div>
        </div>
			</div>
		</div>
	</div>
</template>

<script>
import {checkNum} from '../../lib/tools.js'
	export default{
		data(){
			return {
				dueList:[
				{value:'到期',key:true},
				{value:'未到期',key:false}],
				activeName:"first",
				isShow:false,
				tickNum:'',
				btnStyle:'',
				isTotal:false,
				tableData:[],
				multipleSelection:[],
				pageNo:1,//当前页码
				pageSize:5,//每页条数
				totalPage:1,//总页数
				totalItem:1,//总条数
        acceptorName:'',//承兑人
				startDueDate:'',//到期日区间
				endDueDate:'',//到期日区间
				billMedium:'',//电票纸票
				billType:'',//银票商票
        due:[],//是否到期
        billStatus:'all',//状态
         billStatus_p:'',
         startBillAmount:'',
         endBillAmount:'',
         billStatusList:[],
         billClassify:[],
         billClassifyList:[],
         billSource:[],
         billSourceList:[],
         acceptorType:[],//承兑人类别
         acceptorTypeList:[],//承兑人类别数据源
         dialogVisible:false,
         dialogVisible_d:false,
         loading:false,
         dialogVisible_x:false,
         selectRow:[],
         priceData:[],
         provinceList:[],
         cityList:[],
         province:'',
         city:'',
         priceParams:{
        totalDeductLower:'',
        totalDeductUp:'',
         pageSize:10,
         pageNo:1,
         inquiryId:'',
         sort:''
         },
         loadUrl:''


			}
		},
		mounted(){
      var brief=this.$route.query.brief||'';
       var params="?pageNo="+this.pageNo+"&pageSize="+this.pageSize;
      if(brief)
      {params="?brief=brief&pageNo="+this.pageNo+"&pageSize="+this.pageSize;}
            this.getData(params);
		},
		computed:{
           tickAmount:function(){
           	let self=this;
           	var amounts=0;
           	if(this.multipleSelection!=null){
           		for(var i=0;i<self.multipleSelection.length;i++){
                    amounts+=self.multipleSelection[i].billAmount;
           		}
           	}
           	return amounts
           },
           pieces:function(){
           	return this.multipleSelection.length||0;
           }
		},
		methods:{
			all(){
				this.isTotal=!this.isTotal;
               if(this.isTotal){
               	 this.btnStyle="#a1bddc"
               }
               else{
               	this.btnStyle=""
               }         
			},
	    handleSelectionChange(val) {
           this.multipleSelection = val;
           console.log(this.multipleSelection)
          },

			tabSwitch(tab){
				let self=this;
                 this.loading=true;
                 this.search();
                 // setTimeout(()=>{
                 // 	this.loading=false
                 // },1000)
			},
      telPrice(row){
        let self=this;
        console.log(row);
            this.selectRow=row;
            var body={
                billId:row.id,
                inquiryWay:'dingtalkPC'
            }
            this.dialogVisible_x=true;
             this.$http.post('/dingtalk/inquiry/price',body).then(res=>{
              console.log(res);
                  if(res.data.code=='000000'){
                             self.priceData=res.data.data.result; 
                             self.priceParams.inquiryId=self.priceData[0].inquiryId;

                  }
            })

            this.$http.get('/dingtalk/inquiry/province').then(res=>{
                  if(res.data.code=='000000'){
                    self.provinceList=res.data.data.provinceList;
                  }
            })
      },
      cleans(){
            this.tickNum='';
            this.billClassify='';
            this.billStatus='';
            this.billSource='';
            this.startBillAmount='';
            this.endBillAmount='';
            this.acceptorName='';
            this.acceptorType='';
            this.endDueDate='';
            this.startDueDate='';
            this.due='';
      },
      getPriceList(){
        let self=this;
           var params='?inquiryId='+this.priceParams.inquiryId;
            if(this.priceParams.province!=''){
           params+='&province='+this.province;}
              if(this.priceParams.city!=''){
           params+='&city='+this.city;}
            if(this.priceParams.totalDeductLower!=''){
           params+='&totalDeductLower='+this.priceParams.totalDeductLower;}
           if(this.priceParams.totalDeductUp!=''){
           params+='&totalDeductUp='+this.priceParams.totalDeductUp;}
            if(this.priceParams.pageNo!=''){
           params+='&pageNo='+this.priceParams.pageNo;
           }
            if(this.priceParams.pageSize!=''){
           params+='&pageSize='+this.priceParams.pageSize;
            }
           if(this.priceParams.sort!=''){
            params+='&sort='+this.priceParams.sort;
           }
           this.$http.get('/dingtalk/inquiry/result/list'+params).then(res=>{
            if(res.data.code=='000000'){
              self.priceParams.inquiryId=res.data.data.inquiryId;
              self.priceData=res.data.data.result;
            }
           })


      },
      getCity(){
            let self=this;
            this.city='';
            this.$http.get('/dingtalk/inquiry/city?parentNo='+self.province).then(res=>{
                  if(res.data.code=='000000'){
                    self.cityList=res.data.data.cityList;
                  }
            })
      },
			 dateFormat(data) {//日期格式化
            var fmt = "yyyy-MM-dd";
            var o = {
                "M+": data.getMonth() + 1, //月份 
                "d+": data.getDate(), //日 
                "h+": data.getHours(), //小时 
                "m+": data.getMinutes(), //分 
                "s+": data.getSeconds(), //秒 
                "q+": Math.floor((data.getMonth() + 3) / 3), //季度 
                "S": data.getMilliseconds() //毫秒 
            };
            if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (data.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            return fmt;
         },
           getBillClassify(value){
               console.log(this.billClassify)
           },
           getBillType(e,key){
           	let self =this;
              Array.prototype.remove=function(obj){ 
                for(var i =0;i <this.length;i++){ 
             var temp = this[i]; 
             if(!isNaN(obj)){ 
               temp=i; 
             } 
             if(temp == obj){ 
               for(var j = i;j <this.length;j++){ 
             this[j]=this[j+1]; 
               } 
            this.length = this.length-1; 
             } 
            } 
          } 
          if(e.target.checked){
              self.billClassify.push(key);
          }else{
           self.billClassify.remove(key);
          }
          console.log(this.billClassify);
           },
			actionList(){

			},
			search(){
				let self=this;
				var params="?pageNo="+this.pageNo+"&pageSize="+this.pageSize;
				      if(self.tickNum!=''){
				   	 params+='&billNo='+self.tickNum;
				     }
                     if(self.startDueDate!=''){
				   	 params+='&startDueDate='+self.dateFormat(self.startDueDate);
				     }
				    if(self.endDueDate!=''){
				   	 params+='&endDueDate='+self.dateFormat(self.endDueDate);
				     }
             if(self.acceptorName!=''){
             params+='&acceptorName='+self.acceptorName;
             }
              if(self.startBillAmount!=''){
             params+='&startBillAmount='+self.startBillAmount;
             }
              if(self.endBillAmount!=''){
             params+='&endBillAmount='+self.endBillAmount;
             }
				    if(self.billStatus!=''&&self.billStatus!='all'){

				   	 params+='&billStatus='+self.billStatus;
				     }
				     else{
				     	self.billStatus=''
				     }
				    if(self.billClassify!=null){
				    	 for(var i=0;i<self.billClassify.length;i++){//多选项  
				    	 	params+='&billClassify['+i+']='+self.billClassify[i];
				    	 }
				    };
				    if(self.acceptorType!=null){
				    	for(var i=0;i<self.acceptorType.length;i++){
				    		params+='&acceptorType['+i+']='+self.acceptorType[i];
				    	}
				    }
				    if(self.billSource!=null){
				    	for(var i=0;i<self.billSource.length;i++){
				    		params+='&billSource['+i+']='+self.billSource[i];
				    	}
				    }
				    if(self.due!=null&&self.due!=undefined&&self.due.length==1){
                params+='&due='+self.due[0];
             }		

				this.getData(params);
			},
			getData(params){
				let self=this;
				this.loading=true;
				this.$http.get('/dingtalk/bill/list'+params).then(res=>{
					console.log(res)
					if(res.data.code=='000000'){
						self.totalItem=res.data.data.page.totalCount;
                        self.totalPage=res.data.data.page.totalPages;
						self.tableData=res.data.data.page.result;
						self.billClassifyList=res.data.data.billClassify;
						self.billSourceList=res.data.data.billSource;
						self.acceptorTypeList=res.data.data.acceptorType;
						self.billStatusList=res.data.data.billStatus;
						setTimeout(()=>{
                 	this.loading=false
                       },500)
					}
					else{
						self.loading=false;
					}
				})

			},
		    handleSizeChange(val) {//每页条数变化
		    	this.pageSize=val;
          this.pageNo=1;
		    	this.search();
              console.log(`每页 ${val} 条`);
              console.log(this.totalItem)
             },
			handleCurrentChange(val) {//点击跳页
				this.pageNo=val;
				this.search();
               console.log(`当前页: ${val}`);
             },
             p_update(){
             	let self=this;
             	var ids=[];
             	for(var i=0;i<self.multipleSelection.length;i++){
             		ids.push(self.multipleSelection[i].id)
             	}
             	this.dialogVisible=false;
                this.$http.post
                ('/dingtalk/bill/update/state',{ids:ids,status:self.billStatus_p}).then(res=>{
                	if(res.data.code=='000000'){
                		this.$message({
                        showClose: true,
                         duration:3000,
                         type:'success',
                       message: '批量更新状态成功'
                           });
                		self.search();
                	}
                	else{
                		this.$message({
                        showClose: true,
                        duration:3000,
                         type:'warning',
                       message: '网络异常，更新失败'
                           });
                	}
                })
             },
             p_del(){
             	let self=this;
             	var ids=[];
             	for(var i=0;i<self.multipleSelection.length;i++){
             		ids.push(self.multipleSelection[i].id)
             	}
             	this.dialogVisible_d=false;
                this.$http.post
                ('/dingtalk/bill/del/list',{ids:ids}).then(res=>{
                	if(res.data.code=='000000'){
                		this.$message({
                        showClose: true,
                         duration:3000,
                         type:'success',
                       message: '批量删除成功'
                           });
                		self.search();
                	}
                	else{
                		this.$message({
                        showClose: true,
                        duration:3000,
                         type:'warning',
                       message: '网络异常，删除失败'
                           });
                	}
                })
              
			},
             singleDel(id,version){
               let self=this;
               this.$confirm('确认删除该条数据?', '提示', {
                confirmButtonText: '确定',
              cancelButtonText: '取消',
                type: 'warning'
                 }).then(() => {
                   this.$http.delete("/dingtalk//bill/del/"+version+"/"+id).then(res=>{
                  if(res.data.code=="000000"){
                  this.$message({
                    type: 'success',

                   message: '删除成功!'
                   });
                  self.search();
                }
              else{
              this.$message({
              type: 'warning',
               message: '删除失败，请重试!'
                     });
                       }
                     })
                   }).catch(() => {
          this.$message({
            type: 'info',
            message: '已取消删除'
          });          
           });
            
           },
            edit(id,version,num,type){
            	if(type=='electric'){
             	this.$router.push({path:'/editTicks',query:{id:id,version:version,billNo:num}})
             }
             else{
             	this.$router.push({path:'/editPaperTicks',query:{id:id,version:version,billNo:num}})
             }
           },
           downFile(blob, fileName) {
                 if (window.navigator.msSaveOrOpenBlob) {
                  navigator.msSaveBlob(blob, fileName);
                } else {
             var link = document.createElement('a');
             link.href = window.URL.createObjectURL(blob);
            link.download = fileName;
            link.click();
              window.URL.revokeObjectURL(link.href);
               }
            },
           exportTick(){
           	let self=this;
           	var param="?pageNo="+this.pageNo+"&pageSize="+this.pageSize;
              var params='';
				      if(self.tickNum!=''){
				   	 params+='&billNo='+self.tickNum;
				     }
             if(self.startDueDate!=''){
				   	 params+='&startDueDate='+self.dateFormat(self.startDueDate);
				     }
				    if(self.endDueDate!=''){
				   	 params+='&endDueDate='+self.dateFormat(self.endDueDate);
				     }
				    if(self.billStatus!=''&&self.billStatus!='all'){

				   	 params+='&billStatus='+self.billStatus;
				     }
				     else{
				     	self.billStatus=''
				     }
				    if(self.billClassify!=null){
				    	 for(var i=0;i<self.billClassify.length;i++){//多选项  
				    	 	params+='&billClassify['+i+']='+self.billClassify[i];
				    	 }
				    };
				    if(self.acceptorType!=null){
				    	for(var i=0;i<self.acceptorType.length;i++){
				    		params+='&acceptorType['+i+']='+self.acceptorType[i];
				    	}
				    }
				    if(self.billSource!=null){
				    	for(var i=0;i<self.billSource.length;i++){
				    		params+='&billSource['+i+']='+self.billSource[i];
				    	}
				    }
				    if(self.due!=null){
				    	for(var i=0;i<self.due.length;i++){
				    		params+='&due['+i+']='+self.due[i];
				    	}
				    };
            if(params!=''){
            this.loadUrl='/dingtalk/bill/export'+param+params;
          }
          else{
            this.loadUrl=undefined;
            this.$alert('请输入查询参数')
          }
				    // this.$http.get('/dingtalk/bill/export'+params).then(res=>{
				    // 	// var blob = new Blob([res.data], {type: 'application/vnd.ms-excel'});
        //  //                 fileName = '导出票据';
        //  //                 console.log(blob);
        //  //               self.downFile(blob, fileName);
        //       // window.open('http://www.baidu.com')
                     
        //                self.$biz.util.open('http://www.baidu.com')
				    // })
            
           },
             detail(id,version,type){
             	if(type=='electric'){
             		this.$router.push({path:'/elecTicks',query:{id:id,version:version}})
             	}
             	else{
             		this.$router.push({path:'/paperTicks',query:{id:id,version:version}})
             	}
             }
		}
	}
</script>
<style scoped>
	.el-input__inner{
		width:100%;
	}
	.greyButton{
		background-color: black;
	}
	.cell{
		text-align: center
	}
	.el-popover{
		max-width: 250px;
		margin:0px;
		padding:0px;
	}
</style>
<style> 
.cell{
  text-align: center
}
</style>